# Acceptance Tests v9: Financial Execution

**Status**: AUTHORITATIVE
**Subordinate to**: QUANTUMLIFE_CANON_V1.md, CANON_ADDENDUM_V9_EXECUTION.md, TECHNICAL_SPLIT_V9_EXECUTION.md
**Purpose**: Human-level behavioral tests that MUST pass before v9 release

---

## Test Format

Each test follows this structure:

- **Setup**: Initial conditions and context
- **Action**: What is attempted
- **Expected Outcome**: What MUST happen
- **Audit Evidence Required**: What MUST appear in logs

---

## Category A: Consent and Silence

### A.1 Silence Results in No Execution

**Setup**:
- User initiates a payment proposal for $50 to Recipient
- Approval prompt is displayed
- User does not respond for 24 hours

**Action**:
- System evaluates whether to execute after timeout

**Expected Outcome**:
- Execution MUST NOT occur
- Payment MUST NOT be initiated
- Money MUST remain in original account
- User receives notification that proposal expired without action

**Audit Evidence Required**:
- `approval.requested` with timestamp
- `approval.expired` after timeout period
- NO `execution.started` event
- NO `settlement.pending` event

---

### A.2 Closing Window Without Approval Results in No Execution

**Setup**:
- User opens payment approval screen
- User views all details
- User closes the window without approving or declining

**Action**:
- System evaluates state after window close

**Expected Outcome**:
- Execution MUST NOT occur
- Proposal remains in pending state
- No money moves

**Audit Evidence Required**:
- `approval.requested` event
- NO `approval.submitted` event
- NO `execution.started` event

---

### A.3 Ambiguous Response Results in No Execution

**Setup**:
- Multi-party approval in progress
- Party A approves
- Party B's response is lost due to network failure

**Action**:
- System evaluates whether sufficient approvals exist

**Expected Outcome**:
- Execution MUST NOT occur
- System MUST NOT assume Party B approved
- System MUST NOT assume Party B declined
- Human intervention required to resolve

**Audit Evidence Required**:
- `approval.submitted` for Party A only
- `execution.blocked` with reason "insufficient approvals"
- NO `execution.started` event

---

## Category B: Approval Neutrality

### B.1 Approval Prompt Contains No Urgency Language

**Setup**:
- Payment proposal for utility bill due tomorrow
- Approval prompt is generated

**Action**:
- Examine approval prompt text

**Expected Outcome**:
- Prompt MUST NOT contain words: "urgent", "immediately", "now", "hurry", "deadline", "last chance"
- Prompt MUST NOT contain phrases implying negative consequences of delay
- Prompt MUST be purely descriptive: "Payment of $X to Y. Approve?"

**Audit Evidence Required**:
- `approval.requested` event with prompt text
- Prompt text passes neutral language check

---

### B.2 Approval Prompt Contains No Fear Language

**Setup**:
- Payment proposal exists
- System generates approval prompt

**Action**:
- Examine approval prompt for fear-inducing language

**Expected Outcome**:
- Prompt MUST NOT contain words: "risk", "danger", "warning", "alert", "problem", "issue", "concern"
- Prompt MUST NOT imply negative consequences
- Prompt MUST NOT reference what happens if user declines

**Audit Evidence Required**:
- Prompt text recorded in audit
- Language check verification passed

---

### B.3 Approval Prompt Contains No Authority Language

**Setup**:
- Payment proposal generated by system recommendation
- Approval prompt is displayed

**Action**:
- Examine approval prompt for authority claims

**Expected Outcome**:
- Prompt MUST NOT contain: "recommended", "suggested", "you should", "best practice", "optimal"
- Prompt MUST NOT imply system preference
- Prompt presents facts only, no recommendations

**Audit Evidence Required**:
- Prompt text in audit log
- No authority terms present

---

### B.4 Approval Prompt Contains No Optimization Language

**Setup**:
- Payment could theoretically save money if timed differently
- Approval prompt is generated

**Action**:
- Examine approval prompt content

**Expected Outcome**:
- Prompt MUST NOT contain: "save", "optimize", "better", "improve", "efficient"
- Prompt MUST NOT suggest alternative timing
- Prompt MUST NOT compare to other options

**Audit Evidence Required**:
- Prompt text shows purely factual description
- No optimization framing detected

---

## Category C: No Standing Approval

### C.1 Standing Approval Attempt Is Rejected

**Setup**:
- User attempts to create approval: "Approve all payments under $100"
- System receives this request

**Action**:
- System processes standing approval request

**Expected Outcome**:
- Request MUST be rejected
- Error message MUST explain that each payment requires individual approval
- No standing approval record is created

**Audit Evidence Required**:
- `approval.rejected` with reason "standing approvals forbidden"
- Reference to Canon Addendum v9 ยง5.4

---

### C.2 Category-Wide Approval Attempt Is Rejected

**Setup**:
- User attempts to create approval: "Approve all grocery payments"
- System receives this request

**Action**:
- System processes category approval request

**Expected Outcome**:
- Request MUST be rejected
- Each grocery payment requires its own approval
- No category-wide approval created

**Audit Evidence Required**:
- `approval.rejected` with reason "category-wide approvals forbidden"

---

### C.3 Approval Reuse Is Rejected

**Setup**:
- User approved Payment A yesterday
- Today, Payment B is identical in amount and recipient

**Action**:
- System attempts to use Payment A's approval for Payment B

**Expected Outcome**:
- Execution MUST NOT occur
- Payment B requires its own approval
- Payment A's approval applies only to Payment A

**Audit Evidence Required**:
- `execution.blocked` with reason "approval bound to different ActionHash"
- ActionHash mismatch recorded

---

### C.4 Predictive Approval Is Rejected

**Setup**:
- System observes user always pays Merchant X on the 15th
- System attempts to pre-approve next month's payment

**Action**:
- System generates predictive approval

**Expected Outcome**:
- Predictive approval MUST be rejected
- System MUST NOT create approvals for future unspecified actions
- User must approve when payment is actually proposed

**Audit Evidence Required**:
- NO pre-approval artifact created
- `approval.rejected` if attempted with reason "predictive approvals forbidden"

---

## Category D: Revocation

### D.1 Pre-Execution Revocation Blocks Execution

**Setup**:
- User approves payment at T=0
- Revocation window is 5 minutes
- At T=2 minutes, user revokes approval

**Action**:
- System processes revocation and evaluates execution eligibility

**Expected Outcome**:
- Execution MUST be blocked
- Payment MUST NOT proceed
- ExecutionEnvelope MUST be marked invalid

**Audit Evidence Required**:
- `approval.submitted` at T=0
- `revocation.received` at T=2 minutes
- `execution.blocked` with reason "revocation received"
- NO `execution.started` event

---

### D.2 Mid-Execution Revocation Halts at Safe Point

**Setup**:
- Multi-step execution in progress (e.g., transfer with confirmation)
- Step 1 of 3 completed
- User revokes during Step 2

**Action**:
- System receives revocation signal during execution

**Expected Outcome**:
- Execution MUST halt at next safe point
- Step 2 MUST NOT complete if interruptible
- No further steps proceed
- Partial state is recorded exactly

**Audit Evidence Required**:
- `execution.started`
- `revocation.received` during execution
- `execution.aborted` with reason "revocation during execution"
- Partial state recorded (Step 1 complete, Steps 2-3 not attempted)

---

### D.3 No "Finish What You Started" Behavior

**Setup**:
- Execution is 80% complete
- User revokes
- Completing remaining 20% would be "cleaner"

**Action**:
- System evaluates whether to complete execution

**Expected Outcome**:
- System MUST NOT complete execution
- "Finishing" without consent is forbidden
- Partial state is surfaced to user
- User decides next steps

**Audit Evidence Required**:
- `execution.aborted` NOT `execution.completed`
- Explicit record of incomplete state
- NO post-revocation execution events

---

### D.4 Revocation from Any Approver Invalidates Envelope

**Setup**:
- Multi-party approval with Alice and Bob
- Both approve
- Bob revokes before execution

**Action**:
- System evaluates envelope validity

**Expected Outcome**:
- ExecutionEnvelope MUST be invalid
- Execution MUST NOT proceed
- Alice's approval alone is insufficient
- Fresh approvals from both parties required to proceed

**Audit Evidence Required**:
- `approval.submitted` for Alice and Bob
- `revocation.received` from Bob
- `envelope.invalidated`
- `execution.blocked` with reason "insufficient approvals after revocation"

---

## Category E: Validity Check

### E.1 Affirmative Validity Check Required

**Setup**:
- Approval given at T=0
- Revocation window ends at T=5 minutes
- Execution attempted at T=6 minutes

**Action**:
- System attempts execution

**Expected Outcome**:
- System MUST perform affirmative validity check
- Check MUST verify all conditions still hold
- Execution proceeds only if check passes
- Absence of revocation alone is insufficient

**Audit Evidence Required**:
- `validity.checked` with timestamp and result
- Check result explicitly recorded as "valid" or "invalid"
- Execution proceeds only after explicit "valid" result

---

### E.2 Stale Data Detected by Validity Check

**Setup**:
- Approval based on view with ContentHash A
- Between approval and execution, financial state changed
- Current view has ContentHash B

**Action**:
- System performs validity check

**Expected Outcome**:
- Validity check MUST detect ContentHash mismatch
- Execution MUST be blocked
- User must re-approve with current data

**Audit Evidence Required**:
- `validity.checked` with result "invalid"
- Reason: "view hash mismatch"
- `execution.blocked`

---

### E.3 Expired Approval Detected by Validity Check

**Setup**:
- Approval created with expiry T=1 hour
- Execution attempted at T=2 hours

**Action**:
- System performs validity check

**Expected Outcome**:
- Validity check MUST detect expired approval
- Execution MUST be blocked
- Fresh approval required

**Audit Evidence Required**:
- `validity.checked` with result "invalid"
- Reason: "approval expired"
- `execution.blocked`

---

## Category F: Multi-Party Symmetry

### F.1 Identical View Data for All Approvers

**Setup**:
- Shared expense split between Alice and Bob
- Both must approve execution
- System presents approval to each

**Action**:
- Compare view data shown to Alice vs Bob

**Expected Outcome**:
- View ContentHash MUST be identical for both
- All amounts, categories, totals MUST be identical
- No party-specific filtering or emphasis

**Audit Evidence Required**:
- `approval.requested` for Alice with ViewHash X
- `approval.requested` for Bob with ViewHash X
- Same ViewHash for all parties

---

### F.2 Identical Approval Prompt Language

**Setup**:
- Multi-party approval for shared payment
- System generates prompts for Alice and Bob

**Action**:
- Compare prompt text shown to each

**Expected Outcome**:
- Prompt text MUST be identical
- No personalization that changes meaning
- No "Alice thinks this is a good idea" for Bob

**Audit Evidence Required**:
- Prompt text recorded for each party
- Text comparison shows exact match

---

### F.3 Asymmetric Presentation Attempt Rejected

**Setup**:
- System attempts to show "simplified view" to secondary approver
- Primary approver sees full details

**Action**:
- System generates approval prompts

**Expected Outcome**:
- Asymmetric presentation MUST be rejected
- All parties MUST see same level of detail
- No "simplified" vs "detailed" views

**Audit Evidence Required**:
- All approval prompts contain identical data
- No "simplified" flag or mode exists

---

## Category G: No Retry

### G.1 Failed Execution Does Not Auto-Retry

**Setup**:
- User approves payment
- Execution fails due to network error
- Connection is restored 5 seconds later

**Action**:
- System evaluates whether to retry

**Expected Outcome**:
- System MUST NOT automatically retry
- User must be informed of failure
- User must explicitly approve retry (new approval flow)

**Audit Evidence Required**:
- `execution.started`
- `execution.aborted` with reason "network error"
- NO subsequent `execution.started` without new `approval.submitted`

---

### G.2 Retry Requires Fresh Approval Artifacts

**Setup**:
- Payment execution failed
- User wants to retry

**Action**:
- System creates retry flow

**Expected Outcome**:
- Original approval artifacts MUST NOT be reused
- New approval flow MUST be initiated
- New ActionHash MUST be generated
- New approval artifacts MUST be collected

**Audit Evidence Required**:
- New `approval.requested` event
- New ActionHash (different from original)
- New `approval.submitted` event
- Only then `execution.started`

---

### G.3 Partial Execution Does Not Auto-Complete

**Setup**:
- Execution partially completed
- System could theoretically "finish" the remaining steps

**Action**:
- System evaluates partial state

**Expected Outcome**:
- System MUST NOT auto-complete
- Partial state surfaced to user
- User decides: retry remaining, abandon, or take other action
- Each decision requires explicit consent

**Audit Evidence Required**:
- Partial state explicitly recorded
- NO `execution.completed` without user action
- User decision recorded before any continuation

---

## Category H: Audit Reconstruction

### H.1 Plain-Language Explanation Always Possible

**Setup**:
- Execution completed 3 months ago
- User asks "what happened with that payment to Merchant X?"

**Action**:
- System reconstructs execution history

**Expected Outcome**:
- System MUST produce human-readable explanation
- Explanation includes: what was paid, how much, when, who approved, under what caps
- No jargon or technical identifiers without translation

**Audit Evidence Required**:
- Complete audit trail exists
- Trail can be rendered as: "On [date], you approved a payment of $[X] to [Merchant]. Approved by [names] at [times]. Settled at [time]."

---

### H.2 Authority Path Fully Traceable

**Setup**:
- Complex multi-party execution with threshold approval
- Audit review required

**Action**:
- Trace authority from execution back to approvals

**Expected Outcome**:
- Every approval is identifiable
- Every approver is named
- Every timestamp is recorded
- No gaps or redactions in authority chain

**Audit Evidence Required**:
- Complete chain: `execution.completed` -> `envelope.sealed` -> `approval.verified` (for each approver) -> `approval.submitted` -> `approval.requested`
- All events linked by TraceID

---

### H.3 Caps and Limits Recorded

**Setup**:
- Execution completed under specific caps
- Review required

**Action**:
- Examine audit for cap information

**Expected Outcome**:
- AmountCap, FrequencyCap, DurationCap all recorded
- Actual amount vs cap clearly shown
- Any cap approaching limit flagged

**Audit Evidence Required**:
- ExecutionEnvelope fields recorded
- Comparison of actual execution vs caps

---

## Category I: Failure Defaults

### I.1 Network Failure Results in Non-Execution

**Setup**:
- User approves payment
- Network fails during execution attempt

**Action**:
- System handles network failure

**Expected Outcome**:
- Execution MUST NOT proceed
- Money MUST stay in original account
- User informed of failure
- No partial or uncertain state assumed complete

**Audit Evidence Required**:
- `execution.started`
- `execution.aborted` with reason "network failure"
- NO `settlement.pending` (unless truly uncertain)

---

### I.2 Timeout Results in Non-Execution

**Setup**:
- Execution initiated
- External system does not respond within timeout

**Action**:
- System handles timeout

**Expected Outcome**:
- System assumes non-execution
- No "assume it worked" behavior
- User informed of timeout
- Manual verification suggested

**Audit Evidence Required**:
- `execution.started`
- `execution.aborted` with reason "timeout"
- Status recorded as "uncertain - verification required"

---

### I.3 Ambiguous Response Results in Non-Execution

**Setup**:
- External system returns unclear status
- Cannot determine if payment succeeded or failed

**Action**:
- System handles ambiguous response

**Expected Outcome**:
- System defaults to treating as non-executed
- No assumptions about success
- User informed of ambiguity
- Manual resolution required

**Audit Evidence Required**:
- `execution.started`
- `settlement.disputed` or equivalent uncertainty state
- Explicit flag that human resolution needed

---

## Category J: Anti-Drift Guards

### J.1 Background Executor Detection

**Setup**:
- System under review for compliance
- Searching for background execution patterns

**Action**:
- Audit all code paths that trigger financial execution

**Expected Outcome**:
- NO execution originates from background jobs, crons, or daemons
- Every execution traces to a user-initiated approval
- Any background payment component is a compliance violation

**Audit Evidence Required**:
- Code review confirms no background executors
- All `execution.started` events have preceding user approval chain

---

### J.2 Scheduler Detection

**Setup**:
- System under review
- Searching for scheduled payment patterns

**Action**:
- Examine for time-based execution triggers

**Expected Outcome**:
- NO "run at 3am" payment jobs
- Scheduled proposals require fresh validity check and revocation respect at execution time
- Pure time-based triggers are forbidden

**Audit Evidence Required**:
- No cron-style payment execution
- Scheduled items show `validity.checked` at execution time, not schedule time

---

### J.3 "Small Amount Exception" Detection

**Setup**:
- System under review
- Searching for amount-based bypass logic

**Action**:
- Examine execution paths for amount thresholds

**Expected Outcome**:
- NO "skip approval for amounts under $X" logic
- $1 payments get same approval flow as $10,000 payments
- Amount is not a factor in precondition evaluation

**Audit Evidence Required**:
- No conditional approval bypass based on amount
- All executions show full precondition evaluation regardless of amount

---

### J.4 ML Execution Influence Detection

**Setup**:
- System under review
- Searching for ML-driven execution decisions

**Action**:
- Examine for model-based execution logic

**Expected Outcome**:
- NO ML model influences whether execution proceeds
- NO ML model influences when execution proceeds
- NO ML model influences how execution proceeds
- ML may inform control plane proposals; ML MUST NOT touch execution plane

**Audit Evidence Required**:
- Execution path contains no ML inference calls
- All execution decisions are deterministic based on envelope contents

---

### J.5 Default Execute Path Detection

**Setup**:
- System under review
- Searching for flows where execution is default

**Action**:
- Examine all user flows involving financial execution

**Expected Outcome**:
- NO flow has "execute unless stopped" semantics
- Every flow requires affirmative approval action
- Inaction always results in non-execution

**Audit Evidence Required**:
- All flows require explicit approval event before execution
- No timer-triggered execution
- No "assumed consent" patterns

---

## Release Gate

Before v9 financial execution capability may be released:

### Mandatory Conditions

1. **All Category A-J tests pass** with documented evidence
2. **Zero unintended executions** in testing period
3. **Zero silent actions** (every execution has complete audit trail)
4. **Code review confirms** no forbidden architectures
5. **Multi-party testing confirms** symmetric information presentation
6. **Failure testing confirms** non-execution as default
7. **Revocation testing confirms** immediate halt behavior

### Release Blocking Conditions

Any of the following blocks release:

- Any test in Categories A-J fails
- Any execution occurs without complete approval chain
- Any "finish what you started" behavior detected
- Any standing/blanket approval accepted
- Any asymmetric approval presentation detected
- Any auto-retry behavior detected
- Any background execution detected
- Any small amount exception detected

### Sign-off Required

Release requires explicit sign-off confirming:

> "All v9 acceptance tests pass. Zero unintended executions. Zero silent actions. The system executes only when explicitly approved, halts when revoked, and fails safely."

---

**End of Acceptance Tests v9**
